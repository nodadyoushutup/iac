# MinIO Backend

> **Important:** This stack pins MinIO to `RELEASE.2025-04-22T22-12-26Z`, the
> last build that still ships the legacy admin console. MinIO removed those
> admin features in later releases, so use this setup only for internal
> testing/development and never expose it directly to the public internet.

## Why Docker Compose instead of Terraform

- MinIO hosts the S3-compatible backend that Terraform itself uses for remote
  state, so it must exist **before** the rest of the infrastructure can be
  applied.
- Standing it up with Docker Compose avoids circular dependencies and prevents
  risky state migrations whenever the Terraform modules change.
- Once MinIO is running, every other component is provisioned through
  Terraform and simply points to this instance for backend storage.

## File layout

- `docker/minio/docker-compose.yaml` – defines the single-node MinIO service.
- `docker/minio/.env` – local overrides for credentials and region settings.
- `docker/purge/minio.sh` – helper script that tears the stack down (including
  volumes) when you need a clean slate.

## Bootstrapping MinIO

1. Ensure Docker with Compose v2 is installed and that you can run
   `docker compose`.
2. Create a `.env` file in `docker/minio/` with the variables consumed by
   `docker-compose.yaml`. Example:

   ```bash
   cat <<'EOF' > docker/minio/.env
   MINIO_ROOT_USER=admin
   MINIO_ROOT_PASSWORD=password
   MINIO_REGION_NAME=us-east-1
   MINIO_PROMETHEUS_AUTH_TYPE=public
   EOF
   ```

3. Bring MinIO up from `docker/minio/`:

   ```bash
   (cd docker/minio && docker compose up -d)
   ```

   - S3 endpoint: <http://localhost:9000>
   - Admin console: <http://localhost:9001> (log in using
     `MINIO_ROOT_USER` / `MINIO_ROOT_PASSWORD`)

## Operations

- Tail logs or inspect service state from `docker/minio/`:

  ```bash
  (cd docker/minio && docker compose logs -f minio)
  (cd docker/minio && docker compose ps)
  ```

- Stop the stack but keep data:

  ```bash
  (cd docker/minio && docker compose down)
  ```

- Remove everything (containers, volumes, optional images) via the helper
  script:

  ```bash
  chmod +x docker/purge/minio.sh
  ./docker/purge/minio.sh --prompt           # asks before destroying assets
  ./docker/purge/minio.sh --keep-images      # skip image removal
  ```

## Environment variable reference

There isn't a single official list of all MinIO environment variables. The
command below scrapes them from the binary and can help discover tuning
options:

```bash
grep -r "Env.*=.*\"MINIO_" . | sed 's/.*"\(MINIO_[^"]*\)".*/\1/' | sort
```

```bash
MINIO_ACCESS_KEY
MINIO_ACCESS_KEY_FILE
MINIO_API_CLUSTER_DEADLINE
MINIO_API_CORS_ALLOW_ORIGIN
MINIO_API_DELETE_CLEANUP_INTERVAL
MINIO_API_DISABLE_ODIRECT
MINIO_API_GZIP_OBJECTS
MINIO_API_LIST_QUORUM
MINIO_API_OBJECT_MAX_VERSIONS
MINIO_API_ODIRECT
MINIO_API_REMOTE_TRANSPORT_DEADLINE
MINIO_API_REPLICATION_MAX_LRG_WORKERS
MINIO_API_REPLICATION_MAX_WORKERS
MINIO_API_REPLICATION_PRIORITY
MINIO_API_REQUESTS_DEADLINE
MINIO_API_REQUESTS_MAX
MINIO_API_ROOT_ACCESS
MINIO_API_SECURE_CIPHERS
MINIO_API_STALE_UPLOADS_CLEANUP_INTERVAL
MINIO_API_STALE_UPLOADS_EXPIRY
MINIO_API_SYNC_EVENTS
MINIO_API_TRANSITION_WORKERS
MINIO_ARGS
MINIO_AUDIT_KAFKA_BROKERS
MINIO_AUDIT_KAFKA_CLIENT_TLS_CERT
MINIO_AUDIT_KAFKA_CLIENT_TLS_KEY
MINIO_AUDIT_KAFKA_ENABLE
MINIO_AUDIT_KAFKA_QUEUE_DIR
MINIO_AUDIT_KAFKA_QUEUE_SIZE
MINIO_AUDIT_KAFKA_SASL
MINIO_AUDIT_KAFKA_SASL_MECHANISM
MINIO_AUDIT_KAFKA_SASL_PASSWORD
MINIO_AUDIT_KAFKA_SASL_USERNAME
MINIO_AUDIT_KAFKA_TLS
MINIO_AUDIT_KAFKA_TLS_CLIENT_AUTH
MINIO_AUDIT_KAFKA_TLS_SKIP_VERIFY
MINIO_AUDIT_KAFKA_TOPIC
MINIO_AUDIT_KAFKA_VERSION
MINIO_AUDIT_LOGGER_HTTP_ENDPOINT
MINIO_AUDIT_WEBHOOK_AUTH_TOKEN
MINIO_AUDIT_WEBHOOK_BATCH_SIZE
MINIO_AUDIT_WEBHOOK_CLIENT_CERT
MINIO_AUDIT_WEBHOOK_CLIENT_KEY
MINIO_AUDIT_WEBHOOK_ENABLE
MINIO_AUDIT_WEBHOOK_ENDPOINT
MINIO_AUDIT_WEBHOOK_HTTP_TIMEOUT
MINIO_AUDIT_WEBHOOK_MAX_RETRY
MINIO_AUDIT_WEBHOOK_QUEUE_DIR
MINIO_AUDIT_WEBHOOK_QUEUE_SIZE
MINIO_AUDIT_WEBHOOK_RETRY_INTERVAL
MINIO_BATCH_EXPIRATION_WORKERS_WAIT
MINIO_BATCH_KEYROTATION_WORKERS_WAIT
MINIO_BATCH_REPLICATION_WORKERS_WAIT
MINIO_BROWSER
MINIO_BROWSER_CONTENT_SECURITY_POLICY
MINIO_BROWSER_HSTS_INCLUDE_SUB_DOMAINS
MINIO_BROWSER_HSTS_PRELOAD
MINIO_BROWSER_HSTS_SECONDS
MINIO_BROWSER_LOGIN_ANIMATION
MINIO_BROWSER_REDIRECT
MINIO_BROWSER_REDIRECT_URL
MINIO_BROWSER_REFERRER_POLICY
MINIO_BROWSER_SESSION_DURATION
MINIO_CALLHOME_ENABLE
MINIO_CALLHOME_FREQUENCY
MINIO_CERT_PASSWD
MINIO_COMPRESS
MINIO_COMPRESSION_ALLOW_ENCRYPTION
MINIO_COMPRESSION_ENABLE
MINIO_COMPRESSION_EXTENSIONS
MINIO_COMPRESSION_MIME_TYPES
MINIO_COMPRESS_ALLOW_ENCRYPTION
MINIO_COMPRESS_ENABLE
MINIO_COMPRESS_EXTENSIONS
MINIO_COMPRESS_MIMETYPES
MINIO_COMPRESS_MIME_TYPES
MINIO_CONFIG_ENV_FILE
MINIO_CONSOLE_DEBUG_LOGLEVEL
MINIO_CRAWLER_DELAY
MINIO_CRAWLER_MAX_WAIT
MINIO_DELETE_CLEANUP_INTERVAL
MINIO_DNS_WEBHOOK_ENDPOINT
MINIO_DOMAIN
MINIO_DRIVE_MAX_TIMEOUT
MINIO_ENDPOINTS
MINIO_ERASURE_SET_DRIVE_COUNT
MINIO_ETCD_CLIENT_CERT
MINIO_ETCD_CLIENT_CERT_KEY
MINIO_ETCD_COREDNS_PATH
MINIO_ETCD_ENDPOINTS
MINIO_ETCD_PATH_PREFIX
MINIO_FS_OSYNC
MINIO_HEAL_BITROTSCAN
MINIO_HEAL_DRIVE_WORKERS
MINIO_HEAL_MAX_IO
MINIO_HEAL_MAX_SLEEP
MINIO_IAM_OPA_AUTHTOKEN
MINIO_IAM_OPA_URL
MINIO_IDENTITY_LDAP_GROUP_SEARCH_BASE_DN
MINIO_IDENTITY_LDAP_GROUP_SEARCH_FILTER
MINIO_IDENTITY_LDAP_LOOKUP_BIND_DN
MINIO_IDENTITY_LDAP_LOOKUP_BIND_PASSWORD
MINIO_IDENTITY_LDAP_SERVER_ADDR
MINIO_IDENTITY_LDAP_SERVER_INSECURE
MINIO_IDENTITY_LDAP_SERVER_STARTTLS
MINIO_IDENTITY_LDAP_SRV_RECORD_NAME
MINIO_IDENTITY_LDAP_TLS_SKIP_VERIFY
MINIO_IDENTITY_LDAP_USERNAME_FORMAT
MINIO_IDENTITY_LDAP_USER_DN_ATTRIBUTES
MINIO_IDENTITY_LDAP_USER_DN_SEARCH_BASE_DN
MINIO_IDENTITY_LDAP_USER_DN_SEARCH_FILTER
MINIO_IDENTITY_PLUGIN_AUTH_TOKEN
MINIO_IDENTITY_PLUGIN_ROLE_ID
MINIO_IDENTITY_PLUGIN_ROLE_POLICY
MINIO_IDENTITY_PLUGIN_URL
MINIO_IDENTITY_TLS_ENABLE
MINIO_IDENTITY_TLS_SKIP_VERIFY
MINIO_ILM_EXPIRATION_WORKERS
MINIO_ILM_TRANSITION_WORKERS
MINIO_KMS_API_KEY
MINIO_KMS_AUTO_ENCRYPTION
MINIO_KMS_ENCLAVE
MINIO_KMS_KES_API_KEY
MINIO_KMS_KES_CAPATH
MINIO_KMS_KES_CERT_FILE
MINIO_KMS_KES_ENDPOINT
MINIO_KMS_KES_KEY_FILE
MINIO_KMS_KES_KEY_NAME
MINIO_KMS_KES_KEY_PASSWORD
MINIO_KMS_REPLICATE_KEYID
MINIO_KMS_SECRET_KEY
MINIO_KMS_SECRET_KEY_FILE
MINIO_KMS_SERVER
MINIO_KMS_SSE_KEY
MINIO_LAMBDA_WEBHOOK_AUTH_TOKEN
MINIO_LAMBDA_WEBHOOK_CLIENT_CERT
MINIO_LAMBDA_WEBHOOK_CLIENT_KEY
MINIO_LAMBDA_WEBHOOK_ENABLE
MINIO_LAMBDA_WEBHOOK_ENDPOINT
MINIO_LOGGER_HTTP_ENDPOINT
MINIO_LOGGER_WEBHOOK_AUTH_TOKEN
MINIO_LOGGER_WEBHOOK_BATCH_SIZE
MINIO_LOGGER_WEBHOOK_CLIENT_CERT
MINIO_LOGGER_WEBHOOK_CLIENT_KEY
MINIO_LOGGER_WEBHOOK_ENABLE
MINIO_LOGGER_WEBHOOK_ENDPOINT
MINIO_LOGGER_WEBHOOK_HTTP_TIMEOUT
MINIO_LOGGER_WEBHOOK_MAX_RETRY
MINIO_LOGGER_WEBHOOK_PROXY
MINIO_LOGGER_WEBHOOK_QUEUE_DIR
MINIO_LOGGER_WEBHOOK_QUEUE_SIZE
MINIO_LOGGER_WEBHOOK_RETRY_INTERVAL
MINIO_LOG_QUERY_AUTH_TOKEN
MINIO_LOG_QUERY_URL
MINIO_NOTIFY_AMQP_ARGUMENTS
MINIO_NOTIFY_AMQP_AUTO_DELETED
MINIO_NOTIFY_AMQP_DELIVERY_MODE
MINIO_NOTIFY_AMQP_DURABLE
MINIO_NOTIFY_AMQP_ENABLE
MINIO_NOTIFY_AMQP_EXCHANGE
MINIO_NOTIFY_AMQP_EXCHANGE_TYPE
MINIO_NOTIFY_AMQP_IMMEDIATE
MINIO_NOTIFY_AMQP_INTERNAL
MINIO_NOTIFY_AMQP_MANDATORY
MINIO_NOTIFY_AMQP_NO_WAIT
MINIO_NOTIFY_AMQP_PUBLISHING_CONFIRMS
MINIO_NOTIFY_AMQP_QUEUE_DIR
MINIO_NOTIFY_AMQP_QUEUE_LIMIT
MINIO_NOTIFY_AMQP_ROUTING_KEY
MINIO_NOTIFY_AMQP_URL
MINIO_NOTIFY_ELASTICSEARCH_ENABLE
MINIO_NOTIFY_ELASTICSEARCH_FORMAT
MINIO_NOTIFY_ELASTICSEARCH_INDEX
MINIO_NOTIFY_ELASTICSEARCH_PASSWORD
MINIO_NOTIFY_ELASTICSEARCH_QUEUE_DIR
MINIO_NOTIFY_ELASTICSEARCH_QUEUE_LIMIT
MINIO_NOTIFY_ELASTICSEARCH_URL
MINIO_NOTIFY_ELASTICSEARCH_USERNAME
MINIO_NOTIFY_KAFKA_BATCH_COMMIT_TIMEOUT
MINIO_NOTIFY_KAFKA_BATCH_SIZE
MINIO_NOTIFY_KAFKA_BROKERS
MINIO_NOTIFY_KAFKA_CLIENT_TLS_CERT
MINIO_NOTIFY_KAFKA_CLIENT_TLS_KEY
MINIO_NOTIFY_KAFKA_ENABLE
MINIO_NOTIFY_KAFKA_PRODUCER_COMPRESSION_CODEC
MINIO_NOTIFY_KAFKA_PRODUCER_COMPRESSION_LEVEL
MINIO_NOTIFY_KAFKA_QUEUE_DIR
MINIO_NOTIFY_KAFKA_QUEUE_LIMIT
MINIO_NOTIFY_KAFKA_SASL
MINIO_NOTIFY_KAFKA_SASL_MECHANISM
MINIO_NOTIFY_KAFKA_SASL_PASSWORD
MINIO_NOTIFY_KAFKA_SASL_USERNAME
MINIO_NOTIFY_KAFKA_TLS
MINIO_NOTIFY_KAFKA_TLS_CLIENT_AUTH
MINIO_NOTIFY_KAFKA_TLS_SKIP_VERIFY
MINIO_NOTIFY_KAFKA_TOPIC
MINIO_NOTIFY_KAFKA_VERSION
MINIO_NOTIFY_MQTT_BROKER
MINIO_NOTIFY_MQTT_ENABLE
MINIO_NOTIFY_MQTT_KEEP_ALIVE_INTERVAL
MINIO_NOTIFY_MQTT_PASSWORD
MINIO_NOTIFY_MQTT_QOS
MINIO_NOTIFY_MQTT_QUEUE_DIR
MINIO_NOTIFY_MQTT_QUEUE_LIMIT
MINIO_NOTIFY_MQTT_RECONNECT_INTERVAL
MINIO_NOTIFY_MQTT_TOPIC
MINIO_NOTIFY_MQTT_USERNAME
MINIO_NOTIFY_MYSQL_DATABASE
MINIO_NOTIFY_MYSQL_DSN_STRING
MINIO_NOTIFY_MYSQL_ENABLE
MINIO_NOTIFY_MYSQL_FORMAT
MINIO_NOTIFY_MYSQL_HOST
MINIO_NOTIFY_MYSQL_MAX_OPEN_CONNECTIONS
MINIO_NOTIFY_MYSQL_PASSWORD
MINIO_NOTIFY_MYSQL_PORT
MINIO_NOTIFY_MYSQL_QUEUE_DIR
MINIO_NOTIFY_MYSQL_QUEUE_LIMIT
MINIO_NOTIFY_MYSQL_TABLE
MINIO_NOTIFY_MYSQL_USERNAME
MINIO_NOTIFY_NATS_ADDRESS
MINIO_NOTIFY_NATS_CERT_AUTHORITY
MINIO_NOTIFY_NATS_CLIENT_CERT
MINIO_NOTIFY_NATS_CLIENT_KEY
MINIO_NOTIFY_NATS_ENABLE
MINIO_NOTIFY_NATS_JETSTREAM
MINIO_NOTIFY_NATS_NKEY_SEED
MINIO_NOTIFY_NATS_PASSWORD
MINIO_NOTIFY_NATS_PING_INTERVAL
MINIO_NOTIFY_NATS_QUEUE_DIR
MINIO_NOTIFY_NATS_QUEUE_LIMIT
MINIO_NOTIFY_NATS_STREAMING
MINIO_NOTIFY_NATS_STREAMING_ASYNC
MINIO_NOTIFY_NATS_STREAMING_CLUSTER_ID
MINIO_NOTIFY_NATS_STREAMING_MAX_PUB_ACKS_IN_FLIGHT
MINIO_NOTIFY_NATS_SUBJECT
MINIO_NOTIFY_NATS_TLS
MINIO_NOTIFY_NATS_TLS_HANDSHAKE_FIRST
MINIO_NOTIFY_NATS_TLS_SKIP_VERIFY
MINIO_NOTIFY_NATS_TOKEN
MINIO_NOTIFY_NATS_USERNAME
MINIO_NOTIFY_NSQ_ENABLE
MINIO_NOTIFY_NSQ_NSQD_ADDRESS
MINIO_NOTIFY_NSQ_QUEUE_DIR
MINIO_NOTIFY_NSQ_QUEUE_LIMIT
MINIO_NOTIFY_NSQ_TLS
MINIO_NOTIFY_NSQ_TLS_SKIP_VERIFY
MINIO_NOTIFY_NSQ_TOPIC
MINIO_NOTIFY_POSTGRES_CONNECTION_STRING
MINIO_NOTIFY_POSTGRES_DATABASE
MINIO_NOTIFY_POSTGRES_ENABLE
MINIO_NOTIFY_POSTGRES_FORMAT
MINIO_NOTIFY_POSTGRES_HOST
MINIO_NOTIFY_POSTGRES_MAX_OPEN_CONNECTIONS
MINIO_NOTIFY_POSTGRES_PASSWORD
MINIO_NOTIFY_POSTGRES_PORT
MINIO_NOTIFY_POSTGRES_QUEUE_DIR
MINIO_NOTIFY_POSTGRES_QUEUE_LIMIT
MINIO_NOTIFY_POSTGRES_TABLE
MINIO_NOTIFY_POSTGRES_USERNAME
MINIO_NOTIFY_REDIS_ADDRESS
MINIO_NOTIFY_REDIS_ENABLE
MINIO_NOTIFY_REDIS_FORMAT
MINIO_NOTIFY_REDIS_KEY
MINIO_NOTIFY_REDIS_PASSWORD
MINIO_NOTIFY_REDIS_QUEUE_DIR
MINIO_NOTIFY_REDIS_QUEUE_LIMIT
MINIO_NOTIFY_REDIS_USER
MINIO_NOTIFY_WEBHOOK_AUTH_TOKEN
MINIO_NOTIFY_WEBHOOK_CLIENT_CERT
MINIO_NOTIFY_WEBHOOK_CLIENT_KEY
MINIO_NOTIFY_WEBHOOK_ENABLE
MINIO_NOTIFY_WEBHOOK_ENDPOINT
MINIO_NOTIFY_WEBHOOK_QUEUE_DIR
MINIO_NOTIFY_WEBHOOK_QUEUE_LIMIT
MINIO_NTP_SERVER
MINIO_POLICY_OPA_AUTH_TOKEN
MINIO_POLICY_OPA_URL
MINIO_POLICY_PLUGIN_AUTH_TOKEN
MINIO_POLICY_PLUGIN_ENABLE_HTTP2
MINIO_POLICY_PLUGIN_URL
MINIO_PROMETHEUS_AUTH_TOKEN
MINIO_PROMETHEUS_AUTH_TYPE
MINIO_PROMETHEUS_EXTRA_LABELS
MINIO_PROMETHEUS_JOB_ID
MINIO_PROMETHEUS_OPEN_METRICS
MINIO_PROMETHEUS_URL
MINIO_PUBLIC_IPS
MINIO_REGION
MINIO_REGION_NAME
MINIO_ROOTDISK_THRESHOLD_SIZE
MINIO_ROOTDRIVE_THRESHOLD_SIZE
MINIO_ROOT_PASSWORD
MINIO_ROOT_PASSWORD_FILE
MINIO_ROOT_USER
MINIO_ROOT_USER_FILE
MINIO_SCANNER_ALERT_EXCESS_FOLDERS
MINIO_SCANNER_ALERT_EXCESS_VERSIONS
MINIO_SCANNER_CYCLE
MINIO_SCANNER_DELAY
MINIO_SCANNER_IDLE_SPEED
MINIO_SCANNER_MAX_WAIT
MINIO_SCANNER_SPEED
MINIO_SECRET_KEY
MINIO_SECRET_KEY_FILE
MINIO_SERVER_URL
MINIO_SITE_NAME
MINIO_SITE_REGION
MINIO_STORAGE_CLASS_INLINE_BLOCK
MINIO_STORAGE_CLASS_OPTIMIZE
MINIO_STORAGE_CLASS_RRS
MINIO_STORAGE_CLASS_STANDARD
MINIO_STS_DURATION
MINIO_SUBNET_API_KEY
MINIO_SUBNET_LICENSE
MINIO_SUBNET_PROXY
MINIO_UPDATE
MINIO_VOLUMES
MINIO_WORM
```
